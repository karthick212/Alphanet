!function(e){"use strict";var t=function t(n,a){this.element=e(n),this.options=e.extend(!0,{},e.fn.tag.defaults,a),this.values=e.grep(e.map(this.element.val().split(","),e.trim),function(e){return e.length>0}),this.show()};t.prototype={constructor:t,show:function t(){var n=this;n.element.parent().prepend(n.element.detach().hide()),n.element.wrap(e('<div class="tags">')).parent().on("click",function(){n.input.focus()}),n.values.length&&e.each(n.values,function(){n.createBadge(this)}),n.input=e('<input type="text">').attr("placeholder",n.options.placeholder).insertAfter(n.element).on("focus",function(){n.element.parent().addClass("tags-hover")}).on("blur",function(){n.skip||(n.process(),n.element.parent().removeClass("tags-hover"),n.element.siblings(".tag").removeClass("tag-important")),n.skip=!1}).on("keydown",function(t){if(188==t.keyCode||13==t.keyCode||9==t.keyCode)!e.trim(e(this).val())||n.element.siblings(".typeahead").length&&!n.element.siblings(".typeahead").is(":hidden")?188==t.keyCode&&(n.options.autocompleteOnComma?!n.element.siblings(".typeahead").length||n.element.siblings(".typeahead").is(":hidden")?t.preventDefault():(n.input.data("bs_typeahead").select(),t.stopPropagation(),t.preventDefault()):(t.preventDefault(),n.process())):(9!=t.keyCode&&t.preventDefault(),n.process());else if(e.trim(e(this).val())||8!=t.keyCode)n.element.siblings(".tag").removeClass("tag-important");else{var a=n.element.siblings(".tag").length;if(a){var s=n.element.siblings(".tag:eq("+(a-1)+")");s.hasClass("tag-important")?n.remove(a-1):s.addClass("tag-important")}}}).bs_typeahead({source:n.options.source,matcher:function e(t){return~t.toLowerCase().indexOf(this.query.toLowerCase())&&(-1==n.inValues(t)||n.options.allowDuplicates)},updater:e.proxy(n.add,n)}),e(n.input.data("bs_typeahead").$menu).on("mousedown",function(){n.skip=!0}),this.element.trigger("shown")},inValues:function t(n){if(this.options.caseInsensitive){var a=-1;return e.each(this.values,function(e,t){return t.toLowerCase()==n.toLowerCase()?(a=e,!1):void 0}),a}return e.inArray(n,this.values)},createBadge:function t(n){var a=this;e("<span/>",{class:"tag"}).text(n.toString()).append(e('<button type="button" class="close">&times;</button>').on("click",function(){a.remove(a.element.siblings(".tag").index(e(this).closest(".tag")))})).insertBefore(a.element)},add:function t(n){var a=this;if(!a.options.allowDuplicates){var s=a.inValues(n);if(-1!=s){var i=a.element.siblings(".tag:eq("+s+")");return i.addClass("tag-warning"),void setTimeout(function(){e(i).removeClass("tag-warning")},500)}}this.values.push(n),this.createBadge(n),this.element.val(this.values.join(", ")),this.element.trigger("added",[n])},remove:function e(t){if(t>=0){var n=this.values.splice(t,1);this.element.siblings(".tag:eq("+t+")").remove(),this.element.val(this.values.join(", ")),this.element.trigger("removed",[n])}},process:function t(){var n=e.grep(e.map(this.input.val().split(","),e.trim),function(e){return e.length>0}),a=this;e.each(n,function(){a.add(this)}),this.input.val("")},skip:!1};var n=e.fn.tag;e.fn.tag=function(n){return this.each(function(){var a=e(this),s=a.data("tag"),i="object"==typeof n&&n;s||a.data("tag",s=new t(this,i)),"string"==typeof n&&s[n]()})},e.fn.tag.defaults={allowDuplicates:!1,caseInsensitive:!0,autocompleteOnComma:!1,placeholder:"",source:[]},e.fn.tag.Constructor=t,e.fn.tag.noConflict=function(){return e.fn.tag=n,this},e(window).on("load",function(){e('[data-provide="tag"]').each(function(){var t=e(this);t.data("tag")||t.tag(t.data())})})}(window.jQuery);