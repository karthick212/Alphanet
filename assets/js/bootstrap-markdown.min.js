!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";var e=function e(n,i){var a=["autofocus","savable","hideable","width","height","resize","iconlibrary","language","footer","fullscreen","hiddenButtons","disabledButtons"];t.each(a,function(e,a){"undefined"!=typeof t(n).data(a)&&(i="object"==typeof i?i:{},i[a]=t(n).data(a))}),this.$ns="bootstrap-markdown",this.$element=t(n),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$options=t.extend(!0,{},t.fn.markdown.defaults,i,this.$element.data("options")),this.$oldContent=null,this.$isPreview=!1,this.$isFullscreen=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],this.showEditor()};e.prototype={constructor:e,__alterButtons:function e(n,i){var a=this.$handler,s="all"==n,o=this;t.each(a,function(t,e){var a=!0;a=s?!1:e.indexOf(n)<0,a===!1&&i(o.$editor.find('button[data-handler="'+e+'"]'))})},__buildButtons:function e(n,i){var a,s=this.$ns,o=this.$handler,r=this.$callback;for(a=0;a<n.length;a++){var l,c=n[a];for(l=0;l<c.length;l++){var h,d=c[l].data,u=t("<div/>",{class:"btn-group"});for(h=0;h<d.length;h++){var f,p,g=d[h],v=s+"-"+g.name,m=this.__getIcon(g.icon),b=g.btnText?g.btnText:"",y=g.btnClass?g.btnClass:"btn",x=g.tabIndex?g.tabIndex:"-1",k="undefined"!=typeof g.hotkey?g.hotkey:"",$="undefined"!=typeof jQuery.hotkeys&&""!==k?" ("+k+")":"";f=t("<button></button>"),f.text(" "+this.__localize(b)).addClass("btn-default btn-sm").addClass(y),y.match(/btn\-(primary|success|info|warning|danger|link)/)&&f.removeClass("btn-default"),f.attr({type:"button",title:this.__localize(g.title)+$,tabindex:x,"data-provider":s,"data-handler":v,"data-hotkey":k}),g.toggle===!0&&f.attr("data-toggle","button"),p=t("<span/>"),p.addClass(m),p.prependTo(f),u.append(f),o.push(v),r.push(g.callback)}i.append(u)}}return i},__setListener:function e(){var n="undefined"!=typeof this.$textarea.attr("rows"),i=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",a=n?this.$textarea.attr("rows"):i;this.$textarea.attr("rows",a),this.$options.resize&&this.$textarea.css("resize",this.$options.resize),this.$textarea.on({focus:t.proxy(this.focus,this),keyup:t.proxy(this.keyup,this),change:t.proxy(this.change,this),select:t.proxy(this.select,this)}),this.eventSupported("keydown")&&this.$textarea.on("keydown",t.proxy(this.keydown,this)),this.eventSupported("keypress")&&this.$textarea.on("keypress",t.proxy(this.keypress,this)),this.$textarea.data("markdown",this)},__handle:function e(n){var i=t(n.currentTarget),a=this.$handler,s=this.$callback,o=i.attr("data-handler"),r=a.indexOf(o),l=s[r];t(n.currentTarget).focus(),l(this),this.change(this),o.indexOf("cmdSave")<0&&this.$textarea.focus(),n.preventDefault()},__localize:function e(n){var i=t.fn.markdown.messages,a=this.$options.language;return"undefined"!=typeof i&&"undefined"!=typeof i[a]&&"undefined"!=typeof i[a][n]?i[a][n]:n},__getIcon:function t(e){return"object"==typeof e?e[this.$options.iconlibrary]:e},setFullscreen:function e(n){var i=this.$editor,a=this.$textarea;n===!0?(i.addClass("md-fullscreen-mode"),t("body").addClass("md-nooverflow"),this.$options.onFullscreen(this)):(i.removeClass("md-fullscreen-mode"),t("body").removeClass("md-nooverflow"),1==this.$isPreview&&this.hidePreview().showPreview()),this.$isFullscreen=n,a.focus()},showEditor:function e(){var n,i=this,a=this.$ns,s=this.$element,o=(s.css("height"),s.css("width"),this.$editable),r=this.$handler,l=this.$callback,c=this.$options,h=t("<div/>",{class:"md-editor",click:function t(){i.focus()}});if(null===this.$editor){var d=t("<div/>",{class:"md-header btn-toolbar"}),u=[];if(c.buttons.length>0&&(u=u.concat(c.buttons[0])),c.additionalButtons.length>0&&t.each(c.additionalButtons[0],function(e,n){var i=t.grep(u,function(t,e){return t.name===n.name});i.length>0?i[0].data=i[0].data.concat(n.data):u.push(c.additionalButtons[0][e])}),c.reorderButtonGroups.length>0&&(u=u.filter(function(t){return c.reorderButtonGroups.indexOf(t.name)>-1}).sort(function(t,e){return c.reorderButtonGroups.indexOf(t.name)<c.reorderButtonGroups.indexOf(e.name)?-1:c.reorderButtonGroups.indexOf(t.name)>c.reorderButtonGroups.indexOf(e.name)?1:0})),u.length>0&&(d=this.__buildButtons([u],d)),c.fullscreen.enable&&d.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(c.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(t){t.preventDefault(),i.setFullscreen(!0)}),h.append(d),s.is("textarea"))s.before(h),n=s,n.addClass("md-input"),h.append(n);else{var f="function"==typeof toMarkdown?toMarkdown(s.html()):s.html(),p=t.trim(f);n=t("<textarea/>",{class:"md-input",val:p}),h.append(n),o.el=s,o.type=s.prop("tagName").toLowerCase(),o.content=s.html(),t(s[0].attributes).each(function(){o.attrKeys.push(this.nodeName),o.attrValues.push(this.nodeValue)}),s.replaceWith(h)}var g=t("<div/>",{class:"md-footer"}),v=!1,m="";if(c.savable){v=!0;var b="cmdSave";r.push(b),l.push(c.onSave),g.append('<button class="btn btn-success" data-provider="'+a+'" data-handler="'+b+'"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>")}if(m="function"==typeof c.footer?c.footer(this):c.footer,""!==t.trim(m)&&(v=!0,g.append(m)),v&&h.append(g),c.width&&"inherit"!==c.width&&(jQuery.isNumeric(c.width)?(h.css("display","table"),n.css("width",c.width+"px")):h.addClass(c.width)),c.height&&"inherit"!==c.height)if(jQuery.isNumeric(c.height)){var y=c.height;d&&(y=Math.max(0,y-d.outerHeight())),g&&(y=Math.max(0,y-g.outerHeight())),n.css("height",y+"px")}else h.addClass(c.height);this.$editor=h,this.$textarea=n,this.$editable=o,this.$oldContent=this.getContent(),this.__setListener(),this.$editor.attr("id",(new Date).getTime()),this.$editor.on("click",'[data-provider="bootstrap-markdown"]',t.proxy(this.__handle,this)),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this.eventSupported("keydown")&&"object"==typeof jQuery.hotkeys&&d.find('[data-provider="bootstrap-markdown"]').each(function(){var e=t(this),i=e.attr("data-hotkey");""!==i.toLowerCase()&&n.bind("keydown",i,function(){return e.trigger("click"),!1})}),"preview"===c.initialstate?this.showPreview():"fullscreen"===c.initialstate&&c.fullscreen.enable&&this.setFullscreen(!0)}else this.$editor.show();return c.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active")),c.fullscreen.enable&&c.fullscreen!==!1&&(this.$editor.append('<div class="md-fullscreen-controls"><a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(c.fullscreen.icons.fullscreenOff)+'"></span></a></div>'),this.$editor.on("click",".exit-fullscreen",function(t){t.preventDefault(),i.setFullscreen(!1)})),this.hideButtons(c.hiddenButtons),this.disableButtons(c.disabledButtons),c.onShow(this),this},parseContent:function t(e){var n,e=e||this.$textarea.val();return n=this.$options.parser?this.$options.parser(e):"object"==typeof markdown?markdown.toHTML(e):"function"==typeof marked?marked(e):e},showPreview:function e(){var n,i,a=this.$options,s=this.$textarea,o=s.next(),r=t("<div/>",{class:"md-preview","data-provider":"markdown-preview"});return 1==this.$isPreview?this:(this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),i=a.onPreview(this),n="string"==typeof i?i:this.parseContent(),r.html(n),o&&"md-footer"==o.attr("class")?r.insertBefore(o):s.parent().append(r),r.css({width:s.outerWidth()+"px",height:s.outerHeight()+"px"}),this.$options.resize&&r.css("resize",this.$options.resize),s.hide(),r.data("markdown",this),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this)},hidePreview:function t(){this.$isPreview=!1;var e=this.$editor.find('div[data-provider="markdown-preview"]');return e.remove(),this.enableButtons("all"),this.disableButtons(this.$options.disabledButtons),this.$textarea.show(),this.__setListener(),this},isDirty:function t(){return this.$oldContent!=this.getContent()},getContent:function t(){return this.$textarea.val()},setContent:function t(e){return this.$textarea.val(e),this},findSelection:function t(e){var n,i=this.getContent();if(n=i.indexOf(e),n>=0&&e.length>0){var a,s=this.getSelection();return this.setSelection(n,n+e.length),a=this.getSelection(),this.setSelection(s.start,s.end),a}return null},getSelection:function t(){var e=this.$textarea[0];return("selectionStart"in e&&function(){var t=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:t,text:e.value.substr(e.selectionStart,t)}}||function(){return null})()},setSelection:function t(e,n){var i=this.$textarea[0];return("selectionStart"in i&&function(){i.selectionStart=e,i.selectionEnd=n}||function(){return null})()},replaceSelection:function t(e){var n=this.$textarea[0];return("selectionStart"in n&&function(){return n.value=n.value.substr(0,n.selectionStart)+e+n.value.substr(n.selectionEnd,n.value.length),n.selectionStart=n.value.length,this}||function(){return n.value+=e,jQuery(n)})()},getNextTab:function t(){if(0===this.$nextTab.length)return null;var e,n=this.$nextTab.shift();return"function"==typeof n?e=n():"object"==typeof n&&n.length>0&&(e=n),e},setNextTab:function t(e,n){if("string"==typeof e){var i=this;this.$nextTab.push(function(){return i.findSelection(e)})}else if("number"==typeof e&&"number"==typeof n){var a=this.getSelection();this.setSelection(e,n),this.$nextTab.push(this.getSelection()),this.setSelection(a.start,a.end)}},__parseButtonNameParam:function t(e){return"string"==typeof e?e.split(" "):e},enableButtons:function e(n){var i=this.__parseButtonNameParam(n),a=this;return t.each(i,function(t,e){a.__alterButtons(i[t],function(t){t.removeAttr("disabled")})}),this},disableButtons:function e(n){var i=this.__parseButtonNameParam(n),a=this;return t.each(i,function(t,e){a.__alterButtons(i[t],function(t){t.attr("disabled","disabled")})}),this},hideButtons:function e(n){var i=this.__parseButtonNameParam(n),a=this;return t.each(i,function(t,e){a.__alterButtons(i[t],function(t){t.addClass("hidden")})}),this},showButtons:function e(n){var i=this.__parseButtonNameParam(n),a=this;return t.each(i,function(t,e){a.__alterButtons(i[t],function(t){t.removeClass("hidden")})}),this},eventSupported:function t(e){var n=e in this.$element;return n||(this.$element.setAttribute(e,"return;"),n="function"==typeof this.$element[e]),n},keyup:function t(e){var n=!1;switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var i;if(i=this.getNextTab(),null!==i){var a=this;setTimeout(function(){a.setSelection(i.start,i.end)},500),n=!0}else{var s=this.getSelection();s.start==s.end&&s.end==this.getContent().length?n=!1:(this.setSelection(this.getContent().length,this.getContent().length),n=!0)}break;case 13:n=!1;break;case 27:this.$isFullscreen&&this.setFullscreen(!1),n=!1;break;default:n=!1}n&&(e.stopPropagation(),e.preventDefault()),this.$options.onChange(this)},change:function t(e){return this.$options.onChange(this),this},select:function t(e){return this.$options.onSelect(this),this},focus:function e(n){var i=this.$options,a=(i.hideable,this.$editor);return a.addClass("active"),t(document).find(".md-editor").each(function(){if(t(this).attr("id")!==a.attr("id")){var e;e=t(this).find("textarea").data("markdown"),null===e&&(e=t(this).find('div[data-provider="markdown-preview"]').data("markdown")),e&&e.blur()}}),i.onFocus(this),this},blur:function e(n){var i=this.$options,a=i.hideable,s=this.$editor,o=this.$editable;if(s.hasClass("active")||0===this.$element.parent().length){if(s.removeClass("active"),a)if(null!==o.el){var r=t("<"+o.type+"/>"),l=this.getContent(),c=this.parseContent(l);t(o.attrKeys).each(function(t,e){r.attr(o.attrKeys[t],o.attrValues[t])}),r.html(c),s.replaceWith(r)}else s.hide();i.onBlur(this)}return this}};var n=t.fn.markdown;t.fn.markdown=function(n){return this.each(function(){var i=t(this),a=i.data("markdown"),s="object"==typeof n&&n;a||i.data("markdown",a=new e(this,s))})},t.fn.markdown.messages={},t.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",parser:null,buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function t(e){var n,i,a=e.getSelection(),s=e.getContent();n=0===a.length?e.__localize("strong text"):a.text,"**"===s.substr(a.start-2,2)&&"**"===s.substr(a.end,2)?(e.setSelection(a.start-2,a.end+2),e.replaceSelection(n),i=a.start-2):(e.replaceSelection("**"+n+"**"),i=a.start+2),e.setSelection(i,i+n.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function t(e){var n,i,a=e.getSelection(),s=e.getContent();n=0===a.length?e.__localize("emphasized text"):a.text,"_"===s.substr(a.start-1,1)&&"_"===s.substr(a.end,1)?(e.setSelection(a.start-1,a.end+1),e.replaceSelection(n),i=a.start-1):(e.replaceSelection("_"+n+"_"),i=a.start+1),e.setSelection(i,i+n.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-header","fa-3":"icon-font"},callback:function t(e){var n,i,a,s,o=e.getSelection(),r=e.getContent();n=0===o.length?e.__localize("heading text"):o.text+"\n",a=4,"### "===r.substr(o.start-a,a)||(a=3,"###"===r.substr(o.start-a,a))?(e.setSelection(o.start-a,o.end),e.replaceSelection(n),i=o.start-a):o.start>0&&(s=r.substr(o.start-1,1),!!s&&"\n"!=s)?(e.replaceSelection("\n\n### "+n),i=o.start+6):(e.replaceSelection("### "+n),i=o.start+4),e.setSelection(i,i+n.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function e(n){var i,a,s,o=n.getSelection();n.getContent();i=0===o.length?n.__localize("enter link description here"):o.text,s=prompt(n.__localize("Insert Hyperlink"),"http://");var r=new RegExp("^((http|https)://|(mailto:)|(//))[a-z0-9]","i");if(null!==s&&""!==s&&"http://"!==s&&r.test(s)){var l=t("<div>"+s+"</div>").text();n.replaceSelection("["+i+"]("+l+")"),a=o.start+1,n.setSelection(a,a+i.length)}}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function e(n){var i,a,s,o=n.getSelection();n.getContent();i=0===o.length?n.__localize("enter image description here"):o.text,s=prompt(n.__localize("Insert Image Hyperlink"),"http://");var r=new RegExp("^((http|https)://|(//))[a-z0-9]","i");if(null!==s&&""!==s&&"http://"!==s&&r.test(s)){var l=t("<div>"+s+"</div>").text();n.replaceSelection("!["+i+"]("+l+' "'+n.__localize("enter image title here")+'")'),a=o.start+2,n.setNextTab(n.__localize("enter image title here")),n.setSelection(a,a+i.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function e(n){var i,a,s=n.getSelection();n.getContent();if(0===s.length)i=n.__localize("list text here"),n.replaceSelection("- "+i),a=s.start+2;else if(s.text.indexOf("\n")<0)i=s.text,n.replaceSelection("- "+i),a=s.start+2;else{var o=[];o=s.text.split("\n"),i=o[0],t.each(o,function(t,e){o[t]="- "+e}),n.replaceSelection("\n\n"+o.join("\n")),a=s.start+4}n.setSelection(a,a+i.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function e(n){var i,a,s=n.getSelection();n.getContent();if(0===s.length)i=n.__localize("list text here"),n.replaceSelection("1. "+i),a=s.start+3;else if(s.text.indexOf("\n")<0)i=s.text,n.replaceSelection("1. "+i),a=s.start+3;else{var o=[];o=s.text.split("\n"),i=o[0],t.each(o,function(t,e){o[t]="1. "+e}),n.replaceSelection("\n\n"+o.join("\n")),a=s.start+5}n.setSelection(a,a+i.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function t(e){var n,i,a=e.getSelection(),s=e.getContent();n=0===a.length?e.__localize("code text here"):a.text,"```\n"===s.substr(a.start-4,4)&&"\n```"===s.substr(a.end,4)?(e.setSelection(a.start-4,a.end+4),e.replaceSelection(n),i=a.start-4):"`"===s.substr(a.start-1,1)&&"`"===s.substr(a.end,1)?(e.setSelection(a.start-1,a.end+1),e.replaceSelection(n),i=a.start-1):s.indexOf("\n")>-1?(e.replaceSelection("```\n"+n+"\n```"),i=a.start+4):(e.replaceSelection("`"+n+"`"),i=a.start+1),e.setSelection(i,i+n.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function e(n){var i,a,s=n.getSelection();n.getContent();if(0===s.length)i=n.__localize("quote here"),n.replaceSelection("> "+i),a=s.start+2;else if(s.text.indexOf("\n")<0)i=s.text,n.replaceSelection("> "+i),a=s.start+2;else{var o=[];o=s.text.split("\n"),i=o[0],t.each(o,function(t,e){o[t]="> "+e}),n.replaceSelection("\n\n"+o.join("\n")),a=s.start+4}n.setSelection(a,a+i.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function t(e){var n=e.$isPreview;n===!1?e.showPreview():e.hidePreview()}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function t(e){},onPreview:function t(e){},onSave:function t(e){},onBlur:function t(e){},onFocus:function t(e){},onChange:function t(e){},onFullscreen:function t(e){},onSelect:function t(e){}},t.fn.markdown.Constructor=e,t.fn.markdown.noConflict=function(){return t.fn.markdown=n,this};var i=function t(e){var n=e;return n.data("markdown")?void n.data("markdown").showEditor():void n.markdown()},a=function e(n){var i=t(document.activeElement);t(document).find(".md-editor").each(function(){var e=t(this),n=i.closest(".md-editor")[0]===this,a=e.find("textarea").data("markdown")||e.find('div[data-provider="markdown-preview"]').data("markdown");a&&!n&&a.blur()})};t(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(e){i(t(this)),e.preventDefault()}).on("click focusin",function(t){a(t)}).ready(function(){t('textarea[data-provide="markdown"]').each(function(){i(t(this))})})});