!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var t,n=navigator.userAgent,a=/iphone/i.test(n),i=/chrome/i.test(n),r=/android/i.test(n);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function e(t,n){var a;return 0===this.length||this.is(":hidden")?void 0:"number"==typeof t?(n="number"==typeof n?n:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,n):this.createTextRange&&(a=this.createTextRange(),a.collapse(!0),a.moveEnd("character",n),a.moveStart("character",t),a.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,n=this[0].selectionEnd):document.selection&&document.selection.createRange&&(a=document.selection.createRange(),t=0-a.duplicate().moveStart("character",-1e5),n=t+a.text.length),{begin:t,end:n})},unmask:function e(){return this.trigger("unmask")},mask:function n(o,c){var l,u,f,s,h,g,m,d;if(!o&&this.length>0){l=e(this[0]);var p=l.data(e.mask.dataName);return p?p():void 0}return c=e.extend({autoclear:e.mask.autoclear,placeholder:e.mask.placeholder,completed:null},c),u=e.mask.definitions,f=[],s=m=o.length,h=null,e.each(o.split(""),function(e,t){"?"==t?(m--,s=e):u[t]?(f.push(new RegExp(u[t])),null===h&&(h=f.length-1),s>e&&(g=f.length-1)):f.push(null)}),this.trigger("unmask").each(function(){function n(){if(c.completed){for(var e=h;g>=e;e++){if(f[e]&&C[e]===l(e))return}c.completed.call(w)}}function l(e){return c.placeholder.charAt(e<c.placeholder.length?e:0)}function p(e){for(;++e<m&&!f[e];){}return e}function v(e){for(;--e>=0&&!f[e];){}return e}function b(e,t){var n,a;if(!(0>e)){for(n=e,a=p(t);m>n;n++){if(f[n]){if(!(m>a&&f[n].test(C[a])))break;C[n]=C[a],C[a]=l(a),a=p(a)}}A(),w.caret(Math.max(h,e))}}function k(e){var t,n,a,i;for(t=e,n=l(e);m>t;t++){if(f[t]){if(a=p(t),i=C[t],C[t]=n,!(m>a&&f[a].test(i)))break;n=i}}}function y(){var e=w.val(),t=w.caret();if(d&&d.length&&d.length>e.length){for(T(!0);t.begin>0&&!f[t.begin-1];){t.begin--}if(0===t.begin)for(;t.begin<h&&!f[t.begin];){t.begin++}w.caret(t.begin,t.begin)}else{for(T(!0);t.begin<m&&!f[t.begin];){t.begin++}w.caret(t.begin,t.begin)}n()}function x(){T(),w.val()!=E&&w.change()}function j(e){if(!w.prop("readonly")){var t,n,i,r=e.which||e.keyCode;d=w.val(),8===r||46===r||a&&127===r?(t=w.caret(),n=t.begin,i=t.end,i-n===0&&(n=46!==r?v(n):i=p(n-1),i=46===r?p(i):i),S(n,i),b(n,i-1),e.preventDefault()):13===r?x.call(this,e):27===r&&(w.val(E),w.caret(0,T()),e.preventDefault())}}function R(t){if(!w.prop("readonly")){var a,i,o,c=t.which||t.keyCode,l=w.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||32>c)&&c&&13!==c){if(l.end-l.begin!==0&&(S(l.begin,l.end),b(l.begin,l.end-1)),a=p(l.begin-1),m>a&&(i=String.fromCharCode(c),f[a].test(i))){if(k(a),C[a]=i,A(),o=p(a),r){var u=function t(){e.proxy(e.fn.caret,w,o)()};setTimeout(u,0)}else w.caret(o);l.begin<=g&&n()}t.preventDefault()}}}function S(e,t){var n;for(n=e;t>n&&m>n;n++){f[n]&&(C[n]=l(n))}}function A(){w.val(C.join(""))}function T(e){var t,n,a,i=w.val(),r=-1;for(t=0,a=0;m>t;t++){if(f[t]){for(C[t]=l(t);a++<i.length;){if(n=i.charAt(a-1),f[t].test(n)){C[t]=n,r=t;break}}if(a>i.length){S(t+1,m);break}}else C[t]===i.charAt(a)&&a++,s>t&&(r=t)}return e?A():s>r+1?c.autoclear||C.join("")===D?(w.val()&&w.val(""),S(0,m)):A():(A(),w.val(w.val().substring(0,r+1))),s?t:h}var w=e(this),C=e.map(o.split(""),function(e,t){return"?"!=e?u[e]?l(t):e:void 0}),D=C.join(""),E=w.val();w.data(e.mask.dataName,function(){return e.map(C,function(e,t){return f[t]&&e!=l(t)?e:null}).join("")}),w.one("unmask",function(){w.off(".mask").removeData(e.mask.dataName)}).on("focus.mask",function(){if(!w.prop("readonly")){clearTimeout(t);var e;E=w.val(),e=T(),t=setTimeout(function(){w.get(0)===document.activeElement&&(A(),e==o.replace("?","").length?w.caret(0,e):w.caret(e))},10)}}).on("blur.mask",x).on("keydown.mask",j).on("keypress.mask",R).on("input.mask paste.mask",function(){w.prop("readonly")||setTimeout(function(){var e=T(!0);w.caret(e),n()},0)}),i&&r&&w.off("input.mask").on("input.mask",y),T()})}})});