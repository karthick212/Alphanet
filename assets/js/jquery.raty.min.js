!function(t){"use strict";var a={init:function e(s){return this.each(function(){this.self=t(this),a.destroy.call(this.self),this.opt=t.extend(!0,{},t.fn.raty.defaults,s),a._adjustCallback.call(this),a._adjustNumber.call(this),a._adjustHints.call(this),this.opt.score=a._adjustedScore.call(this,this.opt.score),"img"!==this.opt.starType&&a._adjustStarType.call(this),a._adjustPath.call(this),a._createStars.call(this),this.opt.cancel&&a._createCancel.call(this),this.opt.precision&&a._adjustPrecision.call(this),a._createScore.call(this),a._apply.call(this,this.opt.score),a._setTitle.call(this,this.opt.score),a._target.call(this,this.opt.score),this.opt.readOnly?a._lock.call(this):(this.style.cursor="pointer",a._binds.call(this))})},_adjustCallback:function t(){for(var a=["number","readOnly","score","scoreName","target"],e=0;e<a.length;e++){"function"==typeof this.opt[a[e]]&&(this.opt[a[e]]=this.opt[a[e]].call(this))}},_adjustedScore:function t(e){return e?a._between(e,0,this.opt.number):e},_adjustHints:function t(){if(this.opt.hints||(this.opt.hints=[]),this.opt.halfShow||this.opt.half)for(var a=this.opt.precision?10:2,e=0;e<this.opt.number;e++){var s=this.opt.hints[e];"[object Array]"!==Object.prototype.toString.call(s)&&(s=[s]),this.opt.hints[e]=[];for(var i=0;a>i;i++){var o=s[i],r=s[s.length-1];void 0===r&&(r=null),this.opt.hints[e][i]=void 0===o?r:o}}},_adjustNumber:function t(){this.opt.number=a._between(this.opt.number,1,this.opt.numberMax)},_adjustPath:function t(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.charAt(this.opt.path.length-1)&&(this.opt.path+="/")},_adjustPrecision:function t(){this.opt.half=!0},_adjustStarType:function t(){var a=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var e=0;e<a.length;e++){this.opt[a[e]]=this.opt[a[e]].replace(".","-")}},_apply:function t(e){a._fill.call(this,e),e&&(e>0&&this.score.val(e),a._roundStars.call(this,e))},_between:function t(a,e,s){return Math.min(Math.max(parseFloat(a),e),s)},_binds:function t(){this.cancel&&(a._bindOverCancel.call(this),a._bindClickCancel.call(this),a._bindOutCancel.call(this)),a._bindOver.call(this),a._bindClick.call(this),a._bindOut.call(this)},_bindClick:function e(){var s=this;s.stars.on("click.raty",function(e){var i=!0,o=s.opt.half||s.opt.precision?s.self.data("score"):this.alt||t(this).data("alt");s.opt.click&&(i=s.opt.click.call(s,+o,e)),(i||void 0===i)&&(s.opt.half&&!s.opt.precision&&(o=a._roundHalfScore.call(s,o)),a._apply.call(s,o))})},_bindClickCancel:function t(){var a=this;a.cancel.on("click.raty",function(t){a.score.removeAttr("value"),a.opt.click&&a.opt.click.call(a,null,t)})},_bindOut:function t(){var e=this;e.self.on("mouseleave.raty",function(t){var s=+e.score.val()||void 0;a._apply.call(e,s),a._target.call(e,s,t),a._resetTitle.call(e),e.opt.mouseout&&e.opt.mouseout.call(e,s,t)})},_bindOutCancel:function t(){var e=this;e.cancel.on("mouseleave.raty",function(t){var s=e.opt.cancelOff;if("img"!==e.opt.starType&&(s=e.opt.cancelClass+" "+s),a._setIcon.call(e,this,s),e.opt.mouseout){var i=+e.score.val()||void 0;e.opt.mouseout.call(e,i,t)}})},_bindOver:function t(){var e=this,s=e.opt.half?"mousemove.raty":"mouseover.raty";e.stars.on(s,function(t){var s=a._getScoreByPosition.call(e,t,this);a._fill.call(e,s),e.opt.half&&(a._roundStars.call(e,s,t),a._setTitle.call(e,s,t),e.self.data("score",s)),a._target.call(e,s,t),e.opt.mouseover&&e.opt.mouseover.call(e,s,t)})},_bindOverCancel:function t(){var e=this;e.cancel.on("mouseover.raty",function(t){var s=e.opt.path+e.opt.starOff,i=e.opt.cancelOn;"img"===e.opt.starType?e.stars.attr("src",s):(i=e.opt.cancelClass+" "+i,e.stars.attr("class",s)),a._setIcon.call(e,this,i),a._target.call(e,null,t),e.opt.mouseover&&e.opt.mouseover.call(e,null)})},_buildScoreField:function a(){return t("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this)},_createCancel:function a(){var e=this.opt.path+this.opt.cancelOff,s=t("<"+this.opt.starType+" />",{title:this.opt.cancelHint,class:this.opt.cancelClass});"img"===this.opt.starType?s.attr({src:e,alt:"x"}):s.attr("data-alt","x").addClass(e),"left"===this.opt.cancelPlace?this.self.prepend("&#160;").prepend(s):this.self.append("&#160;").append(s),this.cancel=s},_createScore:function e(){var s=t(this.opt.targetScore);this.score=s.length?s:a._buildScoreField.call(this)},_createStars:function e(){for(var s=1;s<=this.opt.number;s++){var i=a._nameForIndex.call(this,s),o={alt:s,src:this.opt.path+this.opt[i]};"img"!==this.opt.starType&&(o={"data-alt":s,class:o.src}),o.title=a._getHint.call(this,s),t("<"+this.opt.starType+" />",o).appendTo(this),this.opt.space&&this.self.append(s<this.opt.number?"&#160;":"")}this.stars=this.self.children(this.opt.starType)},_error:function a(e){t(this).text(e),t.error(e)},_fill:function t(e){for(var s=0,i=1;i<=this.stars.length;i++){var o,r=this.stars[i-1],n=a._turnOn.call(this,i,e);if(this.opt.iconRange&&this.opt.iconRange.length>s){var l=this.opt.iconRange[s];o=a._getRangeIcon.call(this,l,n),i<=l.range&&a._setIcon.call(this,r,o),i===l.range&&s++}else o=this.opt[n?"starOn":"starOff"],a._setIcon.call(this,r,o)}},_getFirstDecimal:function t(a){var e=a.toString().split(".")[1],s=0;return e&&(s=parseInt(e.charAt(0),10),"9999"===e.slice(1,5)&&s++),s},_getRangeIcon:function t(a,e){return e?a.on||this.opt.starOn:a.off||this.opt.starOff},_getScoreByPosition:function e(s,i){var o=parseInt(i.alt||i.getAttribute("data-alt"),10);if(this.opt.half){var r=a._getWidth.call(this),n=parseFloat((s.pageX-t(i).offset().left)/r);o=o-1+n}return o},_getHint:function t(e,s){if(0!==e&&!e)return this.opt.noRatedMsg;var i=a._getFirstDecimal.call(this,e),o=Math.ceil(e),r=this.opt.hints[(o||1)-1],n=r,l=!s||this.move;return this.opt.precision?(l&&(i=0===i?9:i-1),n=r[i]):(this.opt.halfShow||this.opt.half)&&(i=l&&0===i?1:i>5?1:0,n=r[i]),""===n?"":n||e},_getWidth:function t(){var e=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));return e||a._error.call(this,"Could not get the icon width!"),e},_lock:function t(){var e=a._getHint.call(this,this.score.val());this.style.cursor="",this.title=e,this.score.prop("readonly",!0),this.stars.prop("title",e),this.cancel&&this.cancel.hide(),this.self.data("readonly",!0)},_nameForIndex:function t(a){return this.opt.score&&this.opt.score>=a?"starOn":"starOff"},_resetTitle:function t(e){for(var s=0;s<this.opt.number;s++){this.stars[s].title=a._getHint.call(this,s+1)}},_roundHalfScore:function t(e){var s=parseInt(e,10),i=a._getFirstDecimal.call(this,e);return 0!==i&&(i=i>5?1:.5),s+i},_roundStars:function t(e,s){var i,o=(e%1).toFixed(2);if(s||this.move?i=o>.5?"starOn":"starHalf":o>this.opt.round.down&&(i="starOn",this.opt.halfShow&&o<this.opt.round.up?i="starHalf":o<this.opt.round.full&&(i="starOff")),i){var r=this.opt[i],n=this.stars[Math.ceil(e)-1];a._setIcon.call(this,n,r)}},_setIcon:function t(a,e){a["img"===this.opt.starType?"src":"className"]=this.opt.path+e},_setTarget:function t(a,e){e&&(e=this.opt.targetFormat.toString().replace("{score}",e)),a.is(":input")?a.val(e):a.html(e)},_setTitle:function t(e,s){if(e){var i=parseInt(Math.ceil(e),10),o=this.stars[i-1];o.title=a._getHint.call(this,e,s)}},_target:function e(s,i){if(this.opt.target){var o=t(this.opt.target);o.length||a._error.call(this,"Target selector invalid or missing!");var r=i&&"mouseover"===i.type;if(void 0===s)s=this.opt.targetText;else if(null===s)s=r?this.opt.cancelHint:this.opt.targetText;else{"hint"===this.opt.targetType?s=a._getHint.call(this,s,i):this.opt.precision&&(s=parseFloat(s).toFixed(1));var n=i&&"mousemove"===i.type;r||n||this.opt.targetKeep||(s=this.opt.targetText)}a._setTarget.call(this,o,s)}},_turnOn:function t(a,e){return this.opt.single?a===e:e>=a},_unlock:function t(){this.style.cursor="pointer",this.removeAttribute("title"),this.score.removeAttr("readonly"),this.self.data("readonly",!1);for(var e=0;e<this.opt.number;e++){this.stars[e].title=a._getHint.call(this,e+1)}this.cancel&&this.cancel.css("display","")},cancel:function e(s){return this.each(function(){var e=t(this);e.data("readonly")!==!0&&(a[s?"click":"score"].call(e,null),this.score.removeAttr("value"))})},click:function e(s){return this.each(function(){t(this).data("readonly")!==!0&&(s=a._adjustedScore.call(this,s),a._apply.call(this,s),this.opt.click&&this.opt.click.call(this,s,t.Event("click")),a._target.call(this,s))})},destroy:function a(){return this.each(function(){var a=t(this),e=a.data("raw");e?a.off(".raty").empty().css({cursor:e.style.cursor}).removeData("readonly"):a.data("raw",a.clone()[0])})},getScore:function t(){var a,e=[];return this.each(function(){a=this.score.val(),e.push(a?+a:void 0)}),e.length>1?e:e[0]},move:function e(s){return this.each(function(){var e=parseInt(s,10),i=a._getFirstDecimal.call(this,s);e>=this.opt.number&&(e=this.opt.number-1,i=10);var o=a._getWidth.call(this),r=o/10,n=t(this.stars[e]),l=n.offset().left+r*i,c=t.Event("mousemove",{pageX:l});this.move=!0,n.trigger(c),this.move=!1})},readOnly:function e(s){return this.each(function(){var e=t(this);e.data("readonly")!==s&&(s?(e.off(".raty").children("img").off(".raty"),a._lock.call(this)):(a._binds.call(this),a._unlock.call(this)),e.data("readonly",s))})},reload:function t(){return a.set.call(this,{})},score:function e(){var s=t(this);return arguments.length?a.setScore.apply(s,arguments):a.getScore.call(s)},set:function a(e){return this.each(function(){t(this).raty(t.extend({},this.opt,e))})},setScore:function e(s){return this.each(function(){t(this).data("readonly")!==!0&&(s=a._adjustedScore.call(this,s),a._apply.call(this,s),a._target.call(this,s))})}};t.fn.raty=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist!"):a.init.apply(this,arguments)},t.fn.raty.defaults={cancel:!1,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint"}}(jQuery);