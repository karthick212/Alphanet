!function(t){"use strict";var e=function e(n){var o=t.Deferred(),a=new FileReader;return a.onload=function(t){o.resolve(t.target.result)},a.onerror=o.reject,a.onprogress=o.notify,a.readAsDataURL(n),o.promise()};t.fn.cleanHtml=function(){var e=t(this).html();return e&&e.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},t.fn.wysiwyg=function(n){var o,a,i,r=this,l=function e(){a.activeToolbarClass&&t(a.toolbarSelector).find(i).each(function(){try{var e=t(this).data(a.commandRole);document.queryCommandState(e)?t(this).addClass(a.activeToolbarClass):t(this).removeClass(a.activeToolbarClass)}catch(n){}})},c=function t(e,n){var o=e.split(" "),a=o.shift(),i=o.join(" ")+(n||"");document.execCommand(a,0,i),l()},s=function e(n){t.each(n,function(t,e){r.keydown(t,function(t){r.attr("contenteditable")&&r.is(":visible")&&(t.preventDefault(),t.stopPropagation(),c(e))}).keyup(t,function(t){r.attr("contenteditable")&&r.is(":visible")&&(t.preventDefault(),t.stopPropagation())})})},d=function t(){try{var n=window.getSelection();if(n.getRangeAt&&n.rangeCount)return n.getRangeAt(0)}catch(e){}},u=function t(){o=d()},f=function t(){try{var a=window.getSelection();if(o){try{a.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}a.addRange(o)}}catch(n){}},m=function n(o){r.focus(),t.each(o,function(n,o){/^image\//.test(o.type)?t.when(e(o)).done(function(t){c("insertimage",t)}).fail(function(t){a.fileUploadError("file-reader",t)}):a.fileUploadError("unsupported-file-type",o.type)})},h=function t(e,n){f(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,n||"transparent"),u(),e.data(a.selectionMarker,n)},p=function e(n,o){n.find(i).click(function(){f(),r.focus(),c(t(this).data(o.commandRole)),u()}),n.find("[data-toggle=dropdown]").click(f);var a=!!window.navigator.msPointerEnabled||!!document.all&&!!document.addEventListener;n.find("input[type=text][data-"+o.commandRole+"]").on("webkitspeechchange change",function(){var e=this.value;this.value="",f(),e&&(r.focus(),c(t(this).data(o.commandRole),e)),u()}).on("focus",function(){if(!a){var e=t(this);e.data(o.selectionMarker)||(h(e,o.selectionColor),e.focus())}}).on("blur",function(){if(!a){var e=t(this);e.data(o.selectionMarker)&&h(e,!1)}}),n.find("input[type=file][data-"+o.commandRole+"]").change(function(){f(),"file"===this.type&&this.files&&this.files.length>0&&m(this.files),u(),this.value=""})},g=function t(){r.on("dragenter dragover",!1).on("drop",function(t){var e=t.originalEvent.dataTransfer;t.stopPropagation(),t.preventDefault(),e&&e.files&&e.files.length>0&&m(e.files)})};return a=t.extend({},t.fn.wysiwyg.defaults,n),i="a[data-"+a.commandRole+"],button[data-"+a.commandRole+"],input[type=button][data-"+a.commandRole+"]",s(a.hotKeys),a.dragAndDropImages&&g(),p(t(a.toolbarSelector),a),r.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){u(),l()}),t(window).bind("touchend",function(t){var e=r.is(t.target)||r.has(t.target).length>0,n=d(),o=n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset;o&&!e||(u(),l())}),this},t.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function t(e,n){console.log("File upload error",e,n)}}}(window.jQuery);